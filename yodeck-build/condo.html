<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brokerage Listings</title>

  <!-- ‚úÖ Header CSS + Condo CSS (Inlined, full) -->
  <style>
    /* ===== Header CSS ===== */
    .header-bg {
      width: 100vw;
      background: #fff;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }
    .header {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: none;
      padding: 10px 10px;
      z-index: 1000;
      position: relative;
    }
    .logo-link {
      display: flex;
      align-items: center;
      margin-left: 6px;
      height: 100%;
    }
    .logo {
      height: 30px;
      display: block;
      margin: auto 0;
      transition: height 0.3s ease;
    }
    .desktop-menu {
      display: flex;
      align-items: center;
      gap: 26px;
    }
    .desktop-menu a {
      margin: 0 10px;
      text-decoration: none;
      color: #001D56;
      font-weight: 600;
      font-size: 1.18rem;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-right: 0px;
    }
    .lang-toggle {
      color: #001D56;
      font-weight: bold;
      cursor: pointer;
    }
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      display: none;
    }
    .mobile-menu {
      display: none;
      flex-direction: column;
      position: absolute;
      top: 60px; left: 0; right: 0;
      background: #fff;
      box-shadow: 0 2px 12px #eee;
      z-index: 2000;
      padding: 12px 0 8px 0;
      animation: fadeInMenu 0.2s;
    }
    .mobile-menu a {
      padding: 12px 24px;
      color: #001D56;
      font-weight: 600;
      text-decoration: none;
      font-size: 1.15rem;
      border-bottom: 1px solid #eee;
    }
    .mobile-menu a:last-child { border-bottom: none; }
    .mobile-menu.active { display: flex; }
    @keyframes fadeInMenu {
      from { opacity: 0; transform: translateY(-16px);}
      to { opacity: 1; transform: translateY(0);}
    }
    @media (max-width: 700px) {
      .desktop-menu { display: none; }
      .hamburger { display: block; }
      .header {
        max-width: 100vw;
        padding: 10px 10px;
      }
      .logo { height: 20px; }
      .header-right { gap: 10px; margin-right: 6px; }
      .logo-link { margin-left: 6px; }
    }

    /* ================== (1) Font ================== */
    body {
      font-family: 'Nunito', sans-serif;
      margin: 0; padding: 0;
    }

    /* container: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;  /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤ */
      box-sizing: border-box;
    }

    /* ================== (3) Mid Image Section (from index.html) ================== */
    .mid-image-section {
      position: relative;
      min-height: 65vh;
      width: 100vw;
      background-image: url('center/images/search-bg.jpeg');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      overflow: hidden;
      margin: 0;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
    }

    .search-title {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 4vw;
      font-weight: 600;
      text-shadow: 0 0 8px rgba(0,0,0,0.7);
      z-index: 10;
      pointer-events: none;
      transition: font-size 0.3s ease, top 0.3s ease;
    }

    /* ================== (5) Category Button Row ================== */
    .category-buttons-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 0px; /* ‡∏•‡∏î margin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ö search bar */
    }

    /* ================== (6) ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà Sale/Rent ================== */
    .category-btn {
      background-color: white !important; /* ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà active ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
      color: #001D56 !important;
      border: none !important;
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      border-radius: 0;
      box-shadow: none !important;
    }
    .category-btn:first-child {
      border-left: 0px solid #ccc !important;
    }
    .category-btn:hover {
      background-color: #cce0ff;
    }
    .category-btn.active {
      background-color: #0033cc !important;
      color: white !important;
      border-color: #0033cc !important;
      box-shadow: 0 4px 8px rgba(0,51,204,0.3) !important;
    }

    /* ================== (7) Search Container ================== */
    .search-container {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 900px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 0;
      background-color: transparent !important;
      border-radius: 12px;
      box-shadow: none !important;
    }

    /* ================== (8) Search Bar ================== */
    .search-bar {
      display: flex;
      flex-wrap: nowrap;
      flex-grow: 1;
      background-color: white;
      border-radius: 0px; /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏´‡πâ search bar ‡∏Ç‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏ô (0) */
      overflow: visible;
      width: 100%;
      box-shadow: none;
      border: none;
    }

    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° class full-width ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏≠‡∏ö search box ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏° */
    .search-box.full-width {
      flex: 1 1 100%;
      min-width: auto;
      border-right: none;
      padding-left: 12px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢ */
    }

    /* ================== (9) Box ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á ================== */
    .search-box {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      border-right: 1px solid #ccd6e6;
      min-width: 200px;
      flex: 1 1 200px;
      background-color: transparent;
      border-radius: 0;
    }
    .search-box:last-child {
      border-right: none;
    }

    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á where */
    .search-box.search-box-where {
      min-width: 220px;
    }

    /* ================== (10) Input Field ================== */
    .search-input {
      border: none;
      outline: none;
      font-size: 16px;
      width: 100%;
      color: #001D56;
      background-color: transparent;
      font-weight: 500;
    }

    /* ================== (11) Icon ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input ================== */
    .icon {
      margin-right: 8px;
      font-size: 18px;
      color: #666;
    }

    /* ================== (12) Search Button ================== */
    .search-button {
      padding: 10px 24px;
      background-color: #FF6900;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      flex: 0 0 auto;
      border-radius: 0; /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏∏‡πà‡∏° search ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏°‡∏ô */
      transition: background-color 0.3s ease;
    }
    .search-button:hover {
      background-color: #e05d00;
    }

    /* ================== (13) Search Tags Container ================== */
    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á tag ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
    .search-tags-container {
      margin-top: 12px;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    /* tag individual */
    .search-tag {
      background-color: #0033cc;
      color: white;
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .search-tag:hover {
      background-color: #001a99;
    }

    /* close icon inside tag */
    .search-tag .close-btn {
      font-weight: bold;
      cursor: pointer;
      padding-left: 4px;
      font-size: 16px;
      line-height: 1;
    }

    /* ================== (14) Filter Bar ================== */
    /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î layout filter ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á search bar */
    .filter-bar {
      margin-top: 16px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å search bar */
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-start;
    }

    /* ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á filter */
    .filter-box {
      display: flex;
      flex-direction: column;
      flex: 1 1 200px;
      max-width: 300px;
    }

    /* label filter */
    .filter-box label {
      font-weight: 600;
      margin-bottom: 6px;
      color: #001D56;
      font-size: 14px;
    }

    /* input ‡πÅ‡∏•‡∏∞ select ‡πÉ‡∏ô filter */
    .filter-input {
      font-size: 16px;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccd6e6;
      outline: none;
      color: #001D56;
    }

    /* responsive */
    @media (max-width: 600px) {
      .search-bar {
        flex-direction: column;
      }
      .search-box,
      .search-box-where,
      .search-button {
        width: 100%;
        border-right: none !important;
        border-radius: 12px !important;
        margin-bottom: 8px;
      }
      .search-button {
        margin-bottom: 0;
      }

      /* filter-bar ‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
      .filter-bar {
        flex-direction: column;
      }
      .filter-box {
        max-width: 100%;
        flex: 1 1 100%;
      }
    }

    /* ================== (10) Section and Grid ================== */
    .category-section {
      margin: 0;
      padding: 20px 0;
      background-color: #f9f9ff;
      border-top: 1px solid #ccc;
    }
    .category-section h2 {
      text-align: center;
      color: #001D56;
      margin-bottom: 30px;
    }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
      padding: 0;
      justify-content: start;
    }

    /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ö‡∏ô iPad ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
    @media (min-width: 768px) and (max-width: 1024px) {
      .category-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    @media (max-width: 767px) {
      .category-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ================== (11) Units Section ================== */
    .units-new-style { gap: 24px; }
    .unit-card-new {
      position: relative;
      width: 260px;
      height: 260px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: pointer;
    }
    .unit-image-wrapper {
      position: relative;
      width: 100%;
      height: 260px;
      background: #f5f7fa;
      overflow: hidden;
    }
    .unit-image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: opacity 0.3s ease;
    }
    .condition-overlay {
      position: absolute;
      top: 12px;
      left: 12px;
      background: #ff6900;
      color: #fff;
      font-weight: 700;
      padding: 5px 20px 5px 12px;
      border-radius: 12px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.14);
      letter-spacing: 1px;
      font-size: 0.9rem;
      z-index: 2;
      pointer-events: none;
    }
    /* overlay ‡∏•‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ + ‡∏£‡∏≤‡∏Ñ‡∏≤ */
    .unit-info-left {
      position: absolute;
      bottom: 12px;
      left: 12px;
      color: white;
      font-weight: 700;
      text-shadow: 0 0 6px rgb(0 0 0 / 0.8);
      z-index: 2;
      font-size: 0.9rem;
      max-width: 60%;
      word-wrap: break-word;
      white-space: normal;
    }
    .unit-info-right {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background: rgba(0,0,0,0.5);
      color: white;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      text-align: right;
      max-width: 30%;
      line-height: 1.3;
      z-index: 2;
    }
    .swipe-dots {
      position: absolute;
      top: 8px;
      right: 12px;
      display: flex;
      gap: 6px;
      z-index: 10;
    }
    .swipe-dots .dot {
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      cursor: pointer;
      transition: width 0.3s, height 0.3s, background 0.3s;
    }
    .swipe-dots .dot.active {
      width: 16px;
      height: 16px;
      background: #ff6900;
    }
  </style>
</head>
<body>
  <!-- ‚úÖ Header HTML inlined -->
  <div class="header-bg">
    <header class="header">
      <a href="index.html" class="logo-link">
        <img src="center/images/logo.png" alt="AquaMx Logo" class="logo" />
      </a>
      <nav class="desktop-menu">
        <a href="condo.html">Condo</a>
        <a href="foodies.html">Foodies</a>
        <a href="marketplace.html">Marketplace</a>
      </nav>
      <div class="header-right">
        <div class="lang-toggle">TH / EN</div>
        <div class="hamburger">&#9776;</div>
      </div>
      <nav class="mobile-menu">
        <a href="condo.html">Condo</a>
        <a href="foodies.html">Foodies</a>
        <a href="marketplace.html">Marketplace</a>
      </nav>
    </header>
  </div>

  <!-- Main content -->
  <main>
    <!-- Search Section with Landing Page Format -->
    <section class="mid-image-section">
      <div class="search-title">find anything...</div>

      <div class="search-container">
        <!-- Category buttons matching index.html -->
        <div class="category-buttons-wrapper">
          <button type="button" class="category-btn active" data-value="condo">Condo</button>
          <button type="button" class="category-btn" data-value="foodies">Foodies</button>
          <button type="button" class="category-btn" data-value="marketplace">Marketplace</button>
        </div>

        <div class="search-bar">
          <div class="search-box">
            <span class="icon">üîç</span>
            <input type="text" placeholder="What are you looking for? (e.g. Sushi)" class="search-input" />
          </div>
          <div class="search-box search-box-where">
            <span class="icon">üìç</span>
            <input type="text" placeholder="Where (e.g. Sukhumvit 24)" list="locations" class="search-input" />
            <datalist id="locations">
              <option value="Sukhumvit 24"></option>
              <option value="Sukhumvit 26"></option>
              <option value="Sukhumvit 38"></option>
              <option value="Sukhumvit 39"></option>
            </datalist>
          </div>
          <button class="search-button">Search</button>
        </div>
      </div>
    </section>

    <!-- Units Grid Section -->
    <section id="unitsSection" class="category-section">
      <h2>Units</h2>
      <div class="container">
        <div id="unitsContainer" class="category-grid units-new-style"></div>
      </div>
    </section>
  </main>

  <!-- ‚úÖ Header JS inlined -->
  <script>
    window.addEventListener('DOMContentLoaded', function () {
      const hamburger = document.querySelector('.hamburger');
      const mobileMenu = document.querySelector('.mobile-menu');
      if (hamburger && mobileMenu) {
        hamburger.addEventListener('click', function () {
          mobileMenu.classList.toggle('active');
        });
      }
    });
  </script>

  <!-- External HammerJS (‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö) -->
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>

  <!-- ‚úÖ Condo JS (Inlined, full) -->
  <script>
    let allUnits = [];
    let allProjects = [];

    // ‡πÇ‡∏´‡∏•‡∏î JSON ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    Promise.all([
      fetch('project/ann/data/unit.json').then(async (res) => {
        if (!res.ok) throw new Error(`unit.json HTTP ${res.status}`);
        return res.json();
      }),
      fetch('project/ann/data/project.json').then(async (res) => {
        if (!res.ok) throw new Error(`project.json HTTP ${res.status}`);
        return res.json();
      })
    ])
    .then(([unitData, projectData]) => {
      allUnits = (unitData && Array.isArray(unitData.units)) ? unitData.units : [];
      allProjects = (projectData && Array.isArray(projectData.projects)) ? projectData.projects : [];

      // join ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏¢‡∏π‡∏ô‡∏¥‡∏ï (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠ Unknown ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á render)
      allUnits.forEach(unit => {
        const project = allProjects.find(p => p.project_id === unit.project_id);
        if (project) {
          unit.project_name = project.project_name || 'Unnamed Project';
          unit.project_logo = project.project_logo || '';
          unit.project_address = project.project_address || '';
        } else {
          unit.project_name = 'Unknown Project';
          unit.project_logo = '';
          unit.project_address = '';
        }
      });

      renderUnitsNewStyle(allUnits);
    })
    .catch(err => {
      console.error("Error loading data:", err);
      const container = document.getElementById('unitsContainer');
      if (container) container.innerHTML = '<p style="color:#c00">Cannot load data. Check console.</p>';
    });

    function renderUnitsNewStyle(units) {
      const container = document.getElementById('unitsContainer');
      if (!container) return;

      container.innerHTML = '';

      if (!units || units.length === 0) {
        container.innerHTML = '<p>No units to show.</p>';
        return;
      }

      units.forEach(unit => {
        try {
          const card = document.createElement('div');
          card.className = 'unit-card-new';

          let currentIndex = 0;

          const imageWrapper = document.createElement('div');
          imageWrapper.className = 'unit-image-wrapper';

          const firstImage = (unit.images && unit.images.length) ? unit.images[0] : '';
          const img = document.createElement('img');
          // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏ß‡πâ‡πÉ‡∏ï‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå images/ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ prefix ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
          img.src = firstImage || 'medias/placeholder.jpg';
          img.alt = `${unit.project_name || 'Project'} - ${unit.unit?.room_type || ''} Floor ${unit.unit?.floor ?? ''}`;

          // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ unit details
          card.ondblclick = () => {
            window.location.href = `unit.html?id=${encodeURIComponent(unit.unit_id)}`;
          };
          card.onclick = () => {
            window.location.href = `unit.html?id=${encodeURIComponent(unit.unit_id)}`;
          };

          // ‡∏à‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û (dots)
          const dotsContainer = document.createElement('div');
          dotsContainer.className = 'swipe-dots';

          function updateDots() {
            dotsContainer.innerHTML = '';
            if (!unit.images || unit.images.length === 0) return;
            for (let i = 0; i < unit.images.length; i++) {
              const dot = document.createElement('div');
              dot.className = 'dot';
              if (i === currentIndex) dot.classList.add('active');
              dot.onclick = (e) => {
                e.stopPropagation();
                currentIndex = i;
                img.src = unit.images[currentIndex];
                updateDots();
              };
              dotsContainer.appendChild(dot);
            }
          }
          updateDots();

          // ‚úÖ ‡∏Å‡∏±‡∏ô hammer ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î
          if (typeof Hammer !== 'undefined') {
            const hammer = new Hammer(imageWrapper);
            hammer.on('swipeleft', () => {
              if (!unit.images || unit.images.length === 0) return;
              currentIndex = (currentIndex + 1) % unit.images.length;
              img.src = unit.images[currentIndex];
              updateDots();
            });
            hammer.on('swiperight', () => {
              if (!unit.images || unit.images.length === 0) return;
              currentIndex = (currentIndex - 1 + unit.images.length) % unit.images.length;
              img.src = unit.images[currentIndex];
              updateDots();
            });
          }

          imageWrapper.appendChild(img);
          imageWrapper.appendChild(dotsContainer);

          // badge ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≤‡∏¢/‡πÄ‡∏ä‡πà‡∏≤
          const conditionOverlay = document.createElement('div');
          conditionOverlay.className = 'condition-overlay';
          const selling = !!unit?.condition?.selling_price;
          const renting = !!unit?.condition?.rental_price;
          if (selling && renting) {
            conditionOverlay.textContent = 'Sell & Rent';
          } else if (selling) {
            conditionOverlay.textContent = 'Sell';
          } else if (renting) {
            conditionOverlay.textContent = 'Rent';
          } else {
            conditionOverlay.textContent = '';
          }

          // ‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á: ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ + ‡∏£‡∏≤‡∏Ñ‡∏≤
          const infoLeft = document.createElement('div');
          infoLeft.className = 'unit-info-left';
          let priceText = '';
          const lt = (unit?.unit?.listing_type || '').toLowerCase(); // ‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå
          if (selling) {
            const sellingPrice = Number(unit.condition.selling_price).toLocaleString();
            const pricePerSqm = unit.unit?.room_size
              ? Math.round(Number(unit.condition.selling_price) / unit.unit.room_size).toLocaleString()
              : '';
            priceText = `${sellingPrice} Baht${pricePerSqm ? ` (${pricePerSqm} Baht/sqm.)` : ''}`;
          } else if (renting) {
            priceText = `${Number(unit.condition.rental_price).toLocaleString()} Baht/month`;
          }
          infoLeft.innerText = `${unit.project_name || 'Unknown Project'}\n${priceText}`;

          // ‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á
          const infoRight = document.createElement('div');
          infoRight.className = 'unit-info-right';
          const rt = unit.unit?.room_type || '';
          const rs = unit.unit?.room_size ?? '';
          const fl = unit.unit?.floor ?? '';
          const vw = unit.unit?.view || '';
          infoRight.innerHTML = `
            ${rt} <br/>
            ${rs} sqm <br/>
            Floor ${fl} <br/>
            ${vw}
          `;

          imageWrapper.appendChild(conditionOverlay);
          imageWrapper.appendChild(infoLeft);
          imageWrapper.appendChild(infoRight);

          card.appendChild(imageWrapper);
          container.appendChild(card);
        } catch (e) {
          console.error('Render unit error:', e, unit);
        }
      });

      // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ grid ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏ñ‡∏ß
      const computedStyle = window.getComputedStyle(container);
      const columns = computedStyle.getPropertyValue('grid-template-columns').split(' ').length;
      const emptySlots = columns - (units.length % columns || columns);
      if (emptySlots > 0 && emptySlots < columns) {
        for (let i = 0; i < emptySlots; i++) {
          const emptyDiv = document.createElement('div');
          emptyDiv.style.visibility = 'hidden';
          emptyDiv.style.pointerEvents = 'none';
          container.appendChild(emptyDiv);
        }
      }
    }

    // --------- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ filter & search -----------
    let selectedCategory = 'sell'; // default: sell
    let currentKeyword = '';
    let currentRoomType = '';
    let currentMinRoomSize = 0;
    let currentMaxPrice = 0;

    document.addEventListener('DOMContentLoaded', () => {
      // ‡∏õ‡∏∏‡πà‡∏° Sale / Rent
      const buttons = document.querySelectorAll('.category-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          selectedCategory = (btn.getAttribute('data-value') || '').toLowerCase();
          applyFiltersAndSearch();
        });
      });

      // Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      const keywordInput = document.getElementById('keywordInputBox');
      if (keywordInput) {
        keywordInput.addEventListener('keyup', (e) => {
          if (e.key === 'Enter') {
            applyFiltersAndSearch();
          }
        });
      }

      // ‡∏õ‡∏∏‡πà‡∏° Search
      const searchButton = document.getElementById('keywordSearchButton');
      if (searchButton) {
        searchButton.addEventListener('click', () => {
          applyFiltersAndSearch();
        });
      }

      // ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
      const filterRoomType = document.getElementById('filterRoomType');
      if (filterRoomType) filterRoomType.addEventListener('change', applyFiltersAndSearch);

      const filterRoomSize = document.getElementById('filterRoomSize');
      if (filterRoomSize) filterRoomSize.addEventListener('input', applyFiltersAndSearch);

      const filterMaxPrice = document.getElementById('filterMaxPrice');
      if (filterMaxPrice) filterMaxPrice.addEventListener('input', applyFiltersAndSearch);
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏ß‡∏°‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function applyFiltersAndSearch() {
      const kwEl = document.getElementById('keywordInputBox');
      const rtEl = document.getElementById('filterRoomType');
      const szEl = document.getElementById('filterRoomSize');
      const mxEl = document.getElementById('filterMaxPrice');

      currentKeyword = (kwEl?.value || '').trim().toLowerCase();
      currentRoomType = rtEl?.value || '';
      currentMinRoomSize = parseInt(szEl?.value || '0', 10) || 0;
      currentMaxPrice = parseInt(mxEl?.value || '0', 10) || 0;

      let filtered = allUnits.slice();

      // filter by category: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö both (sell & rent)
      if (selectedCategory) {
        if (selectedCategory !== 'both') {
          filtered = filtered.filter(u => (u.unit?.listing_type || '').toLowerCase() === selectedCategory);
        } else {
          filtered = filtered.filter(u => {
            const lt = (u.unit?.listing_type || '').toLowerCase();
            return lt === 'sell' || lt === 'rent';
          });
        }
      }

      // filter by keyword
      if (currentKeyword) {
        filtered = filtered.filter(unit => {
          const projectName = (unit.project_name || '').toLowerCase();
          const roomType = (unit.unit?.room_type || '').toLowerCase();
          const address = (unit.project_address || '').toLowerCase();
          return projectName.includes(currentKeyword) || roomType.includes(currentKeyword) || address.includes(currentKeyword);
        });
      }

      // room type
      if (currentRoomType) {
        filtered = filtered.filter(u => (u.unit?.room_type || '') === currentRoomType);
      }

      // min room size
      if (currentMinRoomSize > 0) {
        filtered = filtered.filter(u => (u.unit?.room_size || 0) >= currentMinRoomSize);
      }

      // max price
      if (currentMaxPrice > 0) {
        filtered = filtered.filter(u => {
          const lt = (u.unit?.listing_type || '').toLowerCase();
          const price = lt === 'sell' ? u.condition?.selling_price : u.condition?.rental_price;
          return price && Number(price) <= currentMaxPrice;
        });
      }

      renderUnitsNewStyle(filtered);
    }
  </script>
</body>
</html>