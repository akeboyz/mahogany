# Digital Signage System - Conversation Log
**Date:** 29-09-2025
**Session:** JSON Data Structure Cleanup & Project Parameter Removal

## Context & Background
- Working on digital signage deployment package in `C:\Users\Lenovo\OneDrive - MBK Group\Documents\Visual\public\deploy\prj001\`
- Server running on `http://localhost:3002` (ports 3000, 3001 were in use)
- Previous session had issues with file restoration and unauthorized changes causing user frustration

## Issues Identified

### 1. Project Parameter Complexity
- Data files contained multiple projects with `project_ids: ["prj001", "prj002", "prj003"]`
- Required filtering logic in every HTML file
- Cross-project data references causing maintenance overhead
- Some links still referenced prj001 instead of being relative

### 2. File Structure Problems
- `shop.json` had no corresponding category menu (orphaned file)
- Multiple unused JSON files: `foodie.json`, `market.json`, `pm.json`, `videos.json`, `ondeamnd.json` (typo)
- Mixed image references (local paths vs external URLs) causing 404 errors

### 3. Inconsistent Data Paths
- Announcement images: some used local paths `images/announcements/power-outage-prj001.jpg`
- Others used external Unsplash URLs
- prj003 displaying prj001 announcements caused image loading failures

## Actions Taken

### File Restoration & Cleanup
1. **Restored from project001-v2.zip backup** (accidentally overwrote HTML files initially)
2. **Fixed menu.html paths** - corrected video paths from `/ann/medias/` to `./medias/`
3. **Restored category.html from old backup** after accidental overwrite

### JSON File Restructuring
1. **Merged shop.json into ondemand.json:**
   - Added first 2 shops (shop001: AquaMax Ads, shop002: AquaMax Agent) to ondemand.json
   - Deleted remaining shops (shop003-shop012)
   - Completely removed shop.json file

2. **Removed unused JSON files:**
   - ‚úÖ Deleted: `foodie.json`, `market.json`, `pm.json`, `videos.json`, `ondeamnd.json`
   - ‚úÖ Kept active files: `announce.json`, `daily.json`, `deal.json`, `delivery.json`, `dining.json`, `juristic.json`, `ondemand.json`, `medias.json`, `playlist.json`, `project.json`, `unit.json`

### Project Information Update
1. **Updated project.json:**
   - Changed from "The Sukhumvit Residence" to "The Lumpini 24"
   - Used details from old mahogany-signage project.json
   - Updated: location, developer, contact person, facilities, building stats

### Error Fixes
1. **Fixed 404 image errors in product.html:**
   - Enhanced image error handling in `getImageUrl()` function
   - Added error handling to `updateImage()` for gallery navigation
   - Made error handling quieter to reduce console noise

## Current File Mapping
### JSON File ‚Üí HTML Usage:
- **Main Player System:** `playlist.json`, `medias.json`, `announce.json` ‚Üí `index.html`
- **Category System:** `dining.json`, `daily.json`, `delivery.json`, `deal.json`, `ondemand.json`, `juristic.json` ‚Üí `category.html`
- **Product System:** All category JSONs + `unit.json`, `project.json` ‚Üí `product.html`
- **Menu System:** Individual restaurant menus ‚Üí `data/menu/menu/{productId}.json`

## Key URLs (localhost:3002)
- **Menu:** `/deploy/prj001/menu.html?project_id=prj001`
- **Category:** `/deploy/prj001/category.html?type=dining&project_id=prj001`
- **Product:** `/deploy/prj001/product.html?type=restaurant&id=rest001&project_id=prj001`
- **Working prj003:** `/deploy/prj003/menu.html?project_id=prj003` (untouched backup)

## Next Steps Discussed

### Phase 1: Clean JSON Data Files (Recommended)
1. Remove all `project_id` fields from JSON files
2. Filter data to only prj001 relevant items
3. Remove cross-project references

### Phase 2: Update HTML/JavaScript Code
1. Remove `project_id` URL parameter handling
2. Remove filtering logic from HTML files
3. Simplify data loading (no more project filtering)

### Proposed Strategy: **Option A - Start with JSON cleanup**
- Safer approach: clean one JSON file at a time
- Test each change before proceeding
- Start with `announce.json` as it's used by main player

## Technical Improvements Made
- **Enhanced error handling:** Better fallback for missing images
- **Simplified data structure:** Eliminated orphaned shop.json
- **Cleaned unused files:** Removed 5 unused JSON files
- **Updated project branding:** Changed to The Lumpini 24 with proper details
- **Fixed relative paths:** Corrected menu video references

## Lessons Learned
- **Always ask before file changes** - user got frustrated with unauthorized modifications
- **Use project-agnostic data structure** - avoid cross-project filtering complexity
- **Self-contained project folders** - each project should be completely independent
- **Relative paths preferred** - avoid hardcoded project references

## Status
‚úÖ **Completed:** File cleanup, error fixes, project info update
‚è≥ **Next:** Remove project parameters completely from code and data
üìã **Goal:** Self-contained, project-agnostic signage system