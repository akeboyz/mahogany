<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Foodies</title>

  <!-- =================== INLINE CSS (‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤ + ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Foodies) =================== -->
  <style>
    /* ================== Reset & Base ================== */
    * { box-sizing: border-box; }
    body {
      font-family: 'Nunito', sans-serif;
      margin: 0; padding: 0;
      color:#001D56;
      background:#ffffff;
    }
    a { color: inherit; text-decoration: none; }

    /* ===== Header CSS ===== */
    .header-bg {
      width: 100vw;
      background: #fff;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }
    .header {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: none;
      padding: 10px 10px;
      z-index: 1000;
      position: relative;
    }
    .logo-link {
      display: flex;
      align-items: center;
      margin-left: 6px;
      height: 100%;
    }
    .logo {
      height: 30px;
      display: block;
      margin: auto 0;
      transition: height 0.3s ease;
    }
    .desktop-menu {
      display: flex;
      align-items: center;
      gap: 26px;
    }
    .desktop-menu a {
      margin: 0 10px;
      text-decoration: none;
      color: #001D56;
      font-weight: 600;
      font-size: 1.18rem;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-right: 0px;
    }
    .lang-toggle {
      color: #001D56;
      font-weight: bold;
      cursor: pointer;
    }
    .hamburger {
      font-size: 24px;
      cursor: pointer;
      display: none;
    }
    .mobile-menu {
      display: none;
      flex-direction: column;
      position: absolute;
      top: 60px; left: 0; right: 0;
      background: #fff;
      box-shadow: 0 2px 12px #eee;
      z-index: 2000;
      padding: 12px 0 8px 0;
      animation: fadeInMenu 0.2s;
    }
    .mobile-menu a {
      padding: 12px 24px;
      color: #001D56;
      font-weight: 600;
      text-decoration: none;
      font-size: 1.15rem;
      border-bottom: 1px solid #eee;
    }
    .mobile-menu a:last-child { border-bottom: none; }
    .mobile-menu.active { display: flex; }
    @keyframes fadeInMenu {
      from { opacity: 0; transform: translateY(-16px);}
      to { opacity: 1; transform: translateY(0);}
    }
    @media (max-width: 700px) {
      .desktop-menu { display: none; }
      .hamburger { display: block; }
      .header {
        max-width: 100vw;
        padding: 10px 10px;
      }
      .logo { height: 20px; }
      .header-right { gap: 10px; margin-right: 6px; }
      .logo-link { margin-left: 6px; }
    }

    /* ================== Container ================== */
    .container {max-width: 1200px; margin: 0 auto; padding: 0 20px;}

    /* ================== Mid Image Section (from index.html) ================== */
    .mid-image-section {
      position: relative;
      min-height: 65vh;
      width: 100vw;
      background-image: url('center/images/search-bg.jpeg');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      overflow: hidden;
      margin: 0;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
    }

    .search-title {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 4vw;
      font-weight: 600;
      text-shadow: 0 0 8px rgba(0,0,0,0.7);
      z-index: 10;
      pointer-events: none;
      transition: font-size 0.3s ease, top 0.3s ease;
    }
    .search-container {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 900px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 0;
      background-color: transparent !important;
      border-radius: 12px;
      box-shadow: none !important;
    }
    .category-buttons-wrapper {display:flex;justify-content:center;margin-bottom:0;}
    .category-btn {
      background:#fff !important; color:#001D56 !important; border:none !important;
      padding:10px 20px; font-size:1rem; font-weight:600; cursor:pointer; user-select:none; white-space:nowrap;
      transition:background-color .3s ease,color .3s ease,box-shadow .3s ease; border-radius:0; box-shadow:none !important;
    }
    .category-btn:hover{background:#cce0ff;}
    .category-btn.active{background:#0033cc !important;color:#fff !important;border-color:#0033cc !important;box-shadow:0 4px 8px rgba(0,51,204,.3) !important;}

    .search-bar {
      display:flex; flex-wrap:nowrap; flex-grow:1;
      background:#fff; border-radius:0; overflow:visible; width:100%; box-shadow:none; border:none;
      margin-top:12px;
    }
    .search-box{display:flex;align-items:center;padding:10px 16px;border-right:1px solid #ccd6e6;min-width:200px;flex:1 1 200px;background:transparent;border-radius:0;}
    .search-box:last-child{border-right:none;}
    .search-box.full-width{flex:1 1 100%;min-width:auto;border-right:none;padding-left:12px;}
    .icon{margin-right:8px;font-size:18px;color:#666;}
    .search-input{border:none;outline:none;font-size:16px;width:100%;color:#001D56;background:transparent;font-weight:500;}
    .search-button{
      padding:10px 24px;background:#FF6900;color:#fff;border:none;cursor:pointer;font-weight:700;font-size:16px;flex:0 0 auto;border-radius:0;transition:background-color .3s ease;
    }
    .search-button:hover{background:#e05d00;}

    .search-tags-container{margin-top:12px;width:100%;display:flex;flex-wrap:wrap;gap:8px;}
    .search-tag{background:#0033cc;color:#fff;padding:5px 12px;border-radius:12px;font-size:14px;cursor:pointer;user-select:none;display:inline-flex;align-items:center;gap:6px;font-weight:600;transition:background-color .3s ease;}
    .search-tag:hover{background:#001a99;}
    .search-tag .close-btn{font-weight:700;cursor:pointer;padding-left:4px;font-size:16px;line-height:1;}

    @media (max-width: 600px){
      .search-bar{flex-direction:column;}
      .search-box,.search-button{width:100%;border-right:none !important;border-radius:12px !important;margin-bottom:8px;}
      .search-button{margin-bottom:0;}
    }

    /* ================== Section & Grid ================== */
    .category-section{margin:0;padding:20px 0;background:#f9f9ff;border-top:1px solid #ccc;}
    .category-section h2{text-align:center;color:#001D56;margin-bottom:30px;}
    .category-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:24px;padding:0;justify-content:start;
    }
    @media (min-width: 768px) and (max-width: 1024px){ .category-grid{grid-template-columns:repeat(4,1fr);} }
    @media (max-width: 767px){ .category-grid{grid-template-columns:repeat(2,1fr);} }

    /* ================== Card ================== */
    .units-new-style{gap:24px;}
    .unit-card-new{
      position:relative;width:260px;height:260px;background:#fff;border-radius:12px;
      box-shadow:0 2px 8px rgb(0 0 0 / 0.12);overflow:hidden;display:flex;flex-direction:column;cursor:pointer;
    }
    .unit-image-wrapper{position:relative;width:100%;height:260px;background:#f5f7fa;overflow:hidden;}
    .unit-image-wrapper img{width:100%;height:100%;object-fit:cover;display:block;transition:opacity .3s ease;}

    .condition-overlay{
      position:absolute;top:12px;left:12px;background:#ff6900;color:#fff;font-weight:700;
      padding:5px 12px;border-radius:12px;box-shadow:0 1px 8px rgba(0,0,0,.14);letter-spacing:.5px;font-size:.86rem;z-index:2;pointer-events:none;
    }
    .unit-info-left{
      position:absolute;bottom:12px;left:12px;color:#fff;font-weight:700;text-shadow:0 0 6px rgb(0 0 0 / .8);
      z-index:2;font-size:.92rem;max-width:60%;white-space:normal;word-wrap:break-word;line-height:1.2;
    }
    .unit-info-right{
      position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,.5);color:#fff;font-weight:600;padding:8px 12px;border-radius:6px;font-size:.8rem;text-align:right;max-width:35%;line-height:1.3;z-index:2;
    }
    .swipe-dots{position:absolute;top:8px;right:12px;display:flex;gap:6px;z-index:10;}
    .swipe-dots .dot{width:8px;height:8px;background:rgba(255,255,255,.7);border-radius:50%;cursor:pointer;transition:width .3s,height .3s,background .3s;}
    .swipe-dots .dot.active{width:16px;height:16px;background:#ff6900;}
  </style>
</head>
<body>
  <!-- =================== Header =================== -->
  <div class="header-bg">
    <header class="header">
      <a href="index.html" class="logo-link">
        <img src="center/images/logo.png" alt="AquaMx Logo" class="logo" />
      </a>
      <nav class="desktop-menu">
        <a href="condo.html">Condo</a>
        <a href="foodies.html">Foodies</a>
        <a href="marketplace.html">Marketplace</a>
      </nav>
      <div class="header-right">
        <div class="lang-toggle">TH / EN</div>
        <div class="hamburger" id="hamburger">&#9776;</div>
      </div>
      <nav class="mobile-menu" id="mobileMenu">
        <a href="condo.html">Condo</a>
        <a href="foodies.html">Foodies</a>
        <a href="marketplace.html">Marketplace</a>
      </nav>
    </header>
  </div>

  <!-- =================== Search Section with Landing Page Format =================== -->
  <section class="mid-image-section">
    <div class="search-title">find anything...</div>

    <div class="search-container">
      <!-- Category buttons matching index.html -->
      <div class="category-buttons-wrapper">
        <button type="button" class="category-btn" data-value="condo">Condo</button>
        <button type="button" class="category-btn active" data-value="foodies">Foodies</button>
        <button type="button" class="category-btn" data-value="marketplace">Marketplace</button>
      </div>

      <div class="search-bar">
        <div class="search-box">
          <span class="icon">üîç</span>
          <input type="text" placeholder="What are you looking for? (e.g. Sushi)" class="search-input" />
        </div>
        <div class="search-box search-box-where">
          <span class="icon">üìç</span>
          <input type="text" placeholder="Where (e.g. Sukhumvit 24)" list="locations" class="search-input" />
          <datalist id="locations">
            <option value="Sukhumvit 24"></option>
            <option value="Sukhumvit 26"></option>
            <option value="Sukhumvit 38"></option>
            <option value="Sukhumvit 39"></option>
          </datalist>
        </div>
        <button class="search-button">Search</button>
      </div>
    </div>
  </section>

  <!-- =================== Grid =================== -->
  <section id="unitsSection" class="category-section">
    <h2>Restaurants</h2>
    <div class="container">
      <div id="unitsContainer" class="category-grid units-new-style"></div>
    </div>
  </section>

  <!-- =================== Scripts =================== -->
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <script>
    // ====== Header mobile toggle ======
    (function(){
      const burger = document.getElementById('hamburger');
      const menu = document.getElementById('mobileMenu');
      if (burger && menu) {
        burger.addEventListener('click', () => menu.classList.toggle('active'));
      }
    })();

    // ====== State ======
    let allRestaurants = [];
    let selectedService = 'all';
    let currentKeyword = '';
    let currentTags = [];

    // ====== Load project/ann/data/rest.json (array) ======
    fetch('project/ann/data/rest.json')
      .then(res => res.json())
      .then(data => {
        allRestaurants = Array.isArray(data) ? data : (data.restaurants || []);
        renderRestaurants(allRestaurants);
      })
      .catch(err => {
        console.error('Error loading project/ann/data/rest.json:', err);
        document.getElementById('unitsContainer').innerHTML = '<p>Cannot load restaurants data.</p>';
      });

    // ====== UI bindings ======
    document.addEventListener('DOMContentLoaded', () => {
      // category buttons
      const buttons = document.querySelectorAll('.category-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          selectedService = btn.getAttribute('data-value');
          applyFilters();
        });
      });

      // search actions
      const keywordInput = document.getElementById('keywordInputBox');
      const searchBtn = document.getElementById('keywordSearchButton');

      const addTag = (text) => {
        const clean = text.trim();
        if (!clean) return;
        if (!currentTags.includes(clean.toLowerCase())) {
          currentTags.push(clean.toLowerCase());
          renderTags();
          applyFilters();
        }
      };

      if (keywordInput) {
        keywordInput.addEventListener('keyup', (e) => {
          if (e.key === 'Enter') {
            addTag(keywordInput.value);
            keywordInput.value = '';
          }
        });
      }
      if (searchBtn) {
        searchBtn.addEventListener('click', () => {
          addTag(keywordInput.value);
          keywordInput.value = '';
        });
      }
    });

    function renderTags() {
      const box = document.getElementById('searchTagsContainer');
      box.innerHTML = '';
      currentTags.forEach(tag => {
        const el = document.createElement('span');
        el.className = 'search-tag';
        el.innerHTML = `${tag} <span class="close-btn" title="Remove">√ó</span>`;
        el.querySelector('.close-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          currentTags = currentTags.filter(t => t !== tag);
          renderTags();
          applyFilters();
        });
        box.appendChild(el);
      });
    }

    // ====== Filtering ======
    function applyFilters() {
      let filtered = allRestaurants.slice();

      // service filter
      if (selectedService !== 'all') {
        filtered = filtered.filter(r => Array.isArray(r.service_type) && r.service_type.includes(selectedService));
      }

      // keyword tags filter (match ANY tag)
      if (currentTags.length > 0) {
        filtered = filtered.filter(r => {
          const hay = [
            (r.name_th || ''), (r.name_en || ''), (r.category_th || ''), (r.category_en || ''),
            (r.address_th || ''), (r.address_en || ''), (r.location_th || ''), (r.location_en || '')
          ].join(' ').toLowerCase();
          return currentTags.some(tag => hay.includes(tag));
        });
      }

      renderRestaurants(filtered);
    }

    // ====== Renderer ======
    function renderRestaurants(list) {
      const container = document.getElementById('unitsContainer');
      container.innerHTML = '';

      if (!list || list.length === 0) {
        container.innerHTML = '<p>No restaurants to show.</p>';
        return;
      }

      list.forEach(rest => {
        const card = document.createElement('div');
        card.className = 'unit-card-new';

        // ‚úÖ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ rest.html?rest=REST_ID
        card.addEventListener('click', () => {
          window.location.href = `rest.html?rest=${encodeURIComponent(rest.id)}`;
        });

        // image wrapper + swipe
        const imageWrapper = document.createElement('div');
        imageWrapper.className = 'unit-image-wrapper';

        const images = Array.isArray(rest.images) ? rest.images : [];
        let currentIndex = 0;

        const img = document.createElement('img');
        img.src = images[0] || '';
        img.alt = (rest.name_en || rest.name_th || 'Restaurant');

        // dots
        const dotsContainer = document.createElement('div');
        dotsContainer.className = 'swipe-dots';
        function updateDots() {
          dotsContainer.innerHTML = '';
          images.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.className = 'dot' + (i === currentIndex ? ' active' : '');
            dot.addEventListener('click', (e) => {
              e.stopPropagation();
              currentIndex = i;
              img.src = images[currentIndex];
              updateDots();
            });
            dotsContainer.appendChild(dot);
          });
        }
        updateDots();

        if (typeof Hammer !== 'undefined') {
          const hammer = new Hammer(imageWrapper);
          hammer.on('swipeleft', () => {
            if (images.length === 0) return;
            currentIndex = (currentIndex + 1) % images.length;
            img.src = images[currentIndex];
            updateDots();
          });
          hammer.on('swiperight', () => {
            if (images.length === 0) return;
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            img.src = images[currentIndex];
            updateDots();
          });
        }

        imageWrapper.appendChild(img);
        imageWrapper.appendChild(dotsContainer);

        // overlays
        const tagOverlay = document.createElement('div');
        tagOverlay.className = 'condition-overlay';
        tagOverlay.textContent = serviceBadge(rest.service_type);

        const infoLeft = document.createElement('div');
        infoLeft.className = 'unit-info-left';
        const nameLine = rest.name_en || rest.name_th || 'Untitled';
        const catLine = rest.category_en || rest.category_th || '';
        infoLeft.innerText = `${nameLine}\n${catLine}`;

        const infoRight = document.createElement('div');
        infoRight.className = 'unit-info-right';
        infoRight.innerHTML = `
          ${escapeHtml(rest.location_en || rest.location_th || '')}<br/>
          ${escapeHtml(rest.address_en || rest.address_th || '')}
        `;

        imageWrapper.appendChild(tagOverlay);
        imageWrapper.appendChild(infoLeft);
        imageWrapper.appendChild(infoRight);
        card.appendChild(imageWrapper);
        container.appendChild(card);
      });

      // fill blanks to keep grid nice
      const computedStyle = window.getComputedStyle(container);
      const columns = computedStyle.getPropertyValue('grid-template-columns').split(' ').length;
      const emptySlots = columns - (list.length % columns || columns);
      if (emptySlots > 0 && emptySlots < columns) {
        for (let i = 0; i < emptySlots; i++) {
          const emptyDiv = document.createElement('div');
          emptyDiv.style.visibility = 'hidden';
          emptyDiv.style.pointerEvents = 'none';
          container.appendChild(emptyDiv);
        }
      }
    }

    function serviceBadge(arr) {
      if (!Array.isArray(arr) || arr.length === 0) return '';
      const hasWalkin = arr.includes('walk_in');
      const hasDelivery = arr.includes('delivery');
      const hasMobile = arr.includes('mobile_order');
      const hasReserve = arr.includes('reservation');

      const labels = [];
      if (hasWalkin) labels.push('Walk-in');
      if (hasDelivery) labels.push('Delivery');
      if (hasMobile) labels.push('Mobile Order');
      if (hasReserve) labels.push('Reservation');

      if (labels.length === 0 && arr.includes('ads_only')) return 'Ads Only';
      return labels.join(' ‚Ä¢ ') || 'Service';
    }

    function escapeHtml(s){
      return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
  </script>
</body>
</html>